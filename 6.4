import pandas as pd
from datetime import datetime
from datetime import timedelta

ratings = pd.read_csv('C:/Users/karpo/Desktop/Презентации аналитика/python/ml-latest-small/ml-latest-small/ratings.csv')
movie = pd.read_csv('C:/Users/karpo/Desktop/Презентации аналитика/python/ml-latest-small/ml-latest-small/movies.csv')
joined = ratings.merge(movie, on='movieId', how='left')

years = []
start_year, end_year = '1950', '2018'

start_year_d = datetime.strptime(start_year, '%Y')
end_year_d = datetime.strptime(end_year, '%Y')

while start_year_d <= end_year_d:
    years.append(start_year_d.strftime('%Y'))
    
    start_year_d += timedelta(days = 365)
    
def production_year (row):
    for year in years:
        if year in row['title']:
            return (year)
    return '1900'
    
joined ['year'] = joined.apply(production_year, axis = 1)

joined.groupby('year').mean().sort_values('rating', ascending=False)
